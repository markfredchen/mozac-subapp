---
updated: 2025-09-20T05:44:32Z
github: https://github.com/markfredchen/mozac-subapp/issues/10
name: Hot-Reloading Development Server
epic: h5-subapp-platform
status: backlog
created: 2025-09-20T03:51:05Z
depends_on: [003]
parallel: true
conflicts_with: []
size: L
estimated_hours: 24
assignee: unassigned
priority: medium
tags: [development, server, hmr, mobile-debug, testing]
---
updated: 2025-09-20T05:44:32Z
github: https://github.com/markfredchen/mozac-subapp/issues/10

# Task 006: Hot-Reloading Development Server

## Overview

Build a comprehensive development server with Hot Module Replacement (HMR), cross-app testing capabilities, and mobile device debugging support. This server will enhance the developer experience for building and testing H5 sub-applications.

## Technical Requirements

### Hot Module Replacement
- Fast HMR for React components and styles
- State preservation during hot reloads
- Error overlay with clear debugging information
- Support for TypeScript and JSX hot reloading
- WebSocket-based update mechanism

### Cross-App Testing
- Ability to run multiple sub-apps simultaneously
- Inter-app communication testing utilities
- Shared state testing across applications
- Integration testing framework for multi-app scenarios
- Mock native app environment simulation

### Mobile Device Debugging
- Network tunneling for device testing (ngrok-like functionality)
- QR code generation for easy mobile access
- Remote debugging capabilities
- Device-specific testing modes
- Touch event simulation and debugging

### Performance Monitoring
- Real-time bundle size monitoring
- Performance metrics collection
- Memory usage tracking
- Network request monitoring
- Build time optimization tracking

## Dependencies

**Depends On:**
- [003] CLI Tools and Project Scaffolding

**External Dependencies:**
- Vite or Webpack dev server
- WebSocket libraries
- Express.js or similar server framework
- QR code generation libraries
- Network tunneling utilities

## Acceptance Criteria

### Hot Module Replacement
- [ ] React components reload without losing state
- [ ] CSS/SCSS changes apply instantly
- [ ] TypeScript compilation errors shown in overlay
- [ ] HMR works consistently across different browsers
- [ ] Fallback to full reload when HMR fails

### Development Server Features
- [ ] Multi-port support for running multiple sub-apps
- [ ] Proxy configuration for API calls
- [ ] Static asset serving with proper MIME types
- [ ] HTTPS support for secure contexts
- [ ] Graceful error handling and recovery

### Cross-App Testing
- [ ] Launch multiple sub-apps with single command
- [ ] Inter-app message passing simulation
- [ ] Shared dependency testing
- [ ] Integration test runner for multi-app scenarios
- [ ] Mock native app bridge functionality

### Mobile Debugging Support
- [ ] QR code generation for mobile device access
- [ ] Network tunneling for external device testing
- [ ] Touch event debugging and simulation
- [ ] Device viewport simulation
- [ ] Remote console logging and debugging

### Performance Monitoring
- [ ] Real-time bundle size display
- [ ] Build time tracking and optimization suggestions
- [ ] Memory usage monitoring
- [ ] Network request logging
- [ ] Performance bottleneck identification

## Technical Approach

### Server Architecture
```
tools/dev-server/
├── src/
│   ├── server/
│   │   ├── app.ts
│   │   ├── hmr.ts
│   │   ├── proxy.ts
│   │   └── monitoring.ts
│   ├── client/
│   │   ├── hmr-client.ts
│   │   ├── error-overlay.ts
│   │   └── performance.ts
│   ├── utils/
│   │   ├── tunnel.ts
│   │   ├── qr-generator.ts
│   │   └── device-detection.ts
│   └── types/
├── templates/
├── config/
└── package.json
```

### HMR Implementation
- WebSocket connection for real-time updates
- Module dependency tracking for targeted updates
- State preservation using React Fast Refresh
- Error boundary integration for graceful failures

### Mobile Testing Features
- Automatic network interface detection
- QR code generation for easy mobile access
- Device simulation modes (iPhone, Android variants)
- Touch event recording and playback

### Multi-App Orchestration
- Port management for multiple applications
- Shared dependency resolution
- Inter-app communication simulation
- Unified logging and debugging interface

## Risk Mitigation

**HMR Reliability Issues**
- Comprehensive testing across different module types
- Fallback mechanisms for failed hot reloads
- Clear error messages for debugging HMR failures

**Network Connectivity Problems**
- Local fallback when tunneling fails
- Multiple network interface support
- Offline development mode capabilities

**Performance Impact**
- Lazy loading of debugging features
- Optional performance monitoring to reduce overhead
- Efficient WebSocket communication patterns

**Cross-Platform Compatibility**
- Testing on Windows, macOS, and Linux
- Different Node.js version compatibility
- Mobile browser compatibility testing

## Definition of Done

- [ ] HMR works reliably for React, TypeScript, and CSS changes
- [ ] Multiple sub-apps can run simultaneously without conflicts
- [ ] Mobile device debugging features fully functional
- [ ] Performance monitoring provides actionable insights
- [ ] Cross-app testing utilities working correctly
- [ ] QR code and tunneling features operational
- [ ] Error handling and recovery mechanisms tested
- [ ] Documentation complete with usage examples
- [ ] Integration tested with sub-app template
- [ ] Performance benchmarks met (HMR < 200ms)

## Estimated Effort Breakdown

- HMR implementation and optimization: 8 hours
- Cross-app testing capabilities: 6 hours
- Mobile debugging features: 5 hours
- Performance monitoring integration: 3 hours
- Documentation and testing: 2 hours

**Total: 24 hours**

## Testing Strategy

### Unit Testing
- HMR module update logic
- Server routing and proxy functionality
- Mobile debugging utilities
- Performance monitoring accuracy

### Integration Testing
- Multi-app development scenarios
- Mobile device connectivity testing
- Cross-browser HMR compatibility
- Performance monitoring in real applications

### Manual Testing
- Developer workflow validation
- Mobile device testing with real devices
- Performance monitoring accuracy verification
- Error handling and recovery scenarios
