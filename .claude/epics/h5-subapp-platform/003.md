---
name: core-build-system-vite
epic: h5-subapp-platform
status: backlog
created: 2025-09-20T03:51:05Z
depends_on: [001]
parallel: true
conflicts_with: []
size: L
hours: 20
---

# Task 003: Core Build System with Vite

## Description

Configure Vite as the core build system with mobile-specific optimizations, implement advanced bundle splitting and tree-shaking strategies, and create separate development and production build configurations. This system will optimize performance for mobile WebView environments and enable efficient zip packaging.

## Acceptance Criteria

- [ ] Vite configuration package created in tools/build-config
- [ ] Mobile-optimized Vite configuration with performance budgets
- [ ] Bundle splitting strategy for optimal loading performance
- [ ] Tree-shaking configuration to minimize bundle size
- [ ] Development configuration with hot reloading and debugging
- [ ] Production configuration with compression and optimization
- [ ] Asset optimization pipeline for images, fonts, and other resources
- [ ] Source map generation for debugging in production
- [ ] Bundle analysis tooling integrated into build process
- [ ] Performance budgets enforced with build-time validation

## Technical Details

### Build Configuration Structure
```
tools/build-config/
├── vite.base.config.ts      # Shared base configuration
├── vite.dev.config.ts       # Development-specific settings
├── vite.prod.config.ts      # Production optimizations
├── plugins/                 # Custom Vite plugins
│   ├── mobile-optimizer.ts  # Mobile-specific optimizations
│   ├── bundle-analyzer.ts   # Bundle size analysis
│   └── zip-packager.ts      # Zip packaging for native apps
└── utils/                   # Build utilities
```

### Mobile Optimization Features
- Viewport meta tag injection for mobile WebView
- Touch event optimization and gesture handling
- Reduced bundle size with aggressive tree-shaking
- Lazy loading for non-critical components
- Preload hints for critical resources
- Service worker integration for offline capabilities

### Bundle Splitting Strategy
- Vendor chunk for React and core dependencies
- Common chunk for shared utilities and components
- Dynamic imports for route-based code splitting
- Component-level splitting for large feature modules
- CSS extraction and optimization for mobile networks

### Performance Budgets
- Initial bundle: < 1.5MB compressed
- Total bundle: < 3MB compressed
- First Contentful Paint: < 2s on 3G
- Time to Interactive: < 3s on 3G
- Bundle analysis reports generated on each build

### Key Vite Plugins
- @vitejs/plugin-react for React support
- vite-plugin-pwa for service worker integration
- vite-plugin-windicss for atomic CSS
- rollup-plugin-visualizer for bundle analysis
- Custom plugins for mobile optimization and zip packaging

## Dependencies

**Depends on**: [001] - Requires workspace structure and TypeScript configuration

**Parallel with**: [002] - Can be developed simultaneously with CLI

## Effort Estimate

**Size**: L (Large)
**Hours**: 20
**Complexity**: High - Complex build optimization with mobile-specific requirements

## Definition of Done

- [ ] Build system generates optimized bundles under performance budgets
- [ ] Development server starts in < 5 seconds with hot reloading
- [ ] Production builds complete in < 5 minutes for typical sub-app
- [ ] Bundle analysis reports show optimal chunk distribution
- [ ] Tree-shaking eliminates unused code effectively (verified by tests)
- [ ] Source maps work correctly in both development and production
- [ ] Asset optimization reduces image/font sizes by 30%+ without quality loss
- [ ] Build process integrates with CI/CD pipeline without errors
- [ ] Performance budgets fail builds when exceeded
- [ ] Documentation covers build configuration and optimization strategies