---
id: h5-subapp-010
title: Native App Integration Examples
epic: h5-subapp-platform
status: backlog
created: 2025-09-20T03:51:05Z
size: M
hours: 18
depends_on: [007, 009]
parallel: true
conflicts_with: []
---

# Task 010: Native App Integration Examples

## Overview

Create comprehensive iOS and Android integration samples with WebView communication utilities, bridge/plugin examples, and reference implementations to demonstrate best practices for integrating H5 sub-applications into native mobile apps.

## Objectives

- Develop iOS and Android reference integration examples
- Build WebView communication utilities and patterns
- Create bridge/plugin examples for native functionality access
- Provide production-ready integration templates

## Scope

### In Scope
- iOS WebView integration sample application
- Android WebView integration sample application
- Bidirectional communication utilities
- Native bridge examples (camera, storage, notifications)
- Security best practices implementation
- Performance optimization examples
- Error handling and debugging tools

### Out of Scope
- Complex native feature integrations (AR, ML, etc.)
- Platform-specific UI frameworks integration
- Advanced security implementations (biometrics, encryption)
- Production app store deployment guides

## Technical Requirements

### iOS Integration Sample
- **WebView Setup**: WKWebView configuration and lifecycle management
- **Communication Bridge**: JavaScript to Swift communication
- **Resource Loading**: H5 bundle loading and caching strategies
- **Security**: Content security policies and sandboxing
- **Performance**: Memory management and optimization
- **Navigation**: Deep linking and routing integration

### Android Integration Sample
- **WebView Setup**: WebView configuration and customization
- **Communication Bridge**: JavaScript to Java/Kotlin communication
- **Resource Loading**: Asset loading from APK or external sources
- **Security**: WebView security settings and permissions
- **Performance**: Hardware acceleration and optimization
- **Navigation**: Intent handling and fragment integration

### Communication Utilities
- **Message Passing**: Structured message passing between native and web
- **Event System**: Event-driven communication patterns
- **Promise Bridge**: Async/await support for native calls
- **Error Handling**: Comprehensive error propagation and handling
- **Type Safety**: TypeScript definitions for native bridge APIs

### Bridge Examples
- **Device APIs**: Camera, location, contacts, calendar access
- **Storage**: Native storage integration and synchronization
- **Notifications**: Push notifications and local alerts
- **Analytics**: Event tracking and user behavior analytics
- **Authentication**: Native authentication flow integration

## Implementation Details

### iOS Implementation Structure
```
ios-integration-sample/
├── MozacH5Integration/
│   ├── WebViewManager.swift
│   ├── MessageBridge.swift
│   ├── BundleLoader.swift
│   └── NativePlugins/
│       ├── CameraPlugin.swift
│       ├── StoragePlugin.swift
│       └── NotificationPlugin.swift
├── H5Bundle/
│   └── sample-app.zip
└── Documentation/
    └── integration-guide.md
```

### Android Implementation Structure
```
android-integration-sample/
├── app/src/main/java/com/mozac/h5/
│   ├── WebViewManager.java
│   ├── MessageBridge.java
│   ├── BundleLoader.java
│   └── plugins/
│       ├── CameraPlugin.java
│       ├── StoragePlugin.java
│       └── NotificationPlugin.java
├── assets/h5-bundles/
│   └── sample-app.zip
└── docs/
    └── integration-guide.md
```

### Communication Bridge Pattern
```typescript
// TypeScript side
interface NativeBridge {
  camera: {
    takePicture(options: CameraOptions): Promise<string>;
    requestPermissions(): Promise<boolean>;
  };
  storage: {
    set(key: string, value: any): Promise<void>;
    get(key: string): Promise<any>;
  };
  notifications: {
    show(message: string): Promise<void>;
    requestPermissions(): Promise<boolean>;
  };
}
```

```swift
// iOS Swift side
class MessageBridge: NSObject, WKScriptMessageHandler {
    func userContentController(_ userContentController: WKUserContentController,
                              didReceive message: WKScriptMessage) {
        handleMessage(message.body)
    }
}
```

```java
// Android Java side
public class MessageBridge {
    @JavascriptInterface
    public void postMessage(String message) {
        handleMessage(message);
    }
}
```

## Acceptance Criteria

- [ ] **iOS Sample App**: Complete iOS app with H5 integration
- [ ] **Android Sample App**: Complete Android app with H5 integration
- [ ] **Communication Bridge**: Bidirectional native-web communication
- [ ] **Plugin Examples**: Working examples for camera, storage, notifications
- [ ] **Bundle Loading**: Efficient H5 bundle loading and caching
- [ ] **Error Handling**: Comprehensive error handling and debugging
- [ ] **Performance**: Optimized for mobile performance
- [ ] **Security**: Secure communication and resource access
- [ ] **Documentation**: Detailed integration guides and API docs
- [ ] **TypeScript Support**: Full TypeScript definitions for bridges

## Testing Strategy

### Integration Tests
- End-to-end communication between native and web
- Bundle loading and caching functionality
- Plugin API functionality across platforms
- Error handling and recovery scenarios

### Platform Tests
- iOS WebView behavior and performance
- Android WebView compatibility across versions
- Memory usage and performance profiling
- Security validation and penetration testing

### User Experience Tests
- App launch and loading performance
- Navigation and deep linking
- Offline functionality and caching
- Cross-platform consistency

## Dependencies

### Internal Dependencies
- [007] Zip Packaging and Bundle System - For bundle format and loading
- [009] Documentation and API Guides - For integration documentation
- Shared component library for consistent UI
- CLI tools for bundle creation and deployment

### External Dependencies
- iOS development environment (Xcode, Swift)
- Android development environment (Android Studio, Java/Kotlin)
- WebView debugging tools
- Mobile testing frameworks

## Risks and Mitigation

### Platform Risks
- **WebView Differences**: Behavior inconsistencies between platforms
  - *Mitigation*: Comprehensive cross-platform testing and fallbacks
- **OS Version Compatibility**: New OS versions breaking integration
  - *Mitigation*: Version compatibility matrix and regular updates

### Performance Risks
- **Memory Usage**: High memory consumption in WebView
  - *Mitigation*: Memory profiling and optimization techniques
- **Loading Performance**: Slow bundle loading affecting UX
  - *Mitigation*: Caching strategies and progressive loading

### Security Risks
- **Bridge Vulnerabilities**: Exposed native APIs being misused
  - *Mitigation*: Permission-based access and input validation
- **Content Security**: Malicious content execution
  - *Mitigation*: Content security policies and sandboxing

## Success Metrics

- Sample apps demonstrate complete integration workflow
- Bridge communication latency under 50ms for typical calls
- Bundle loading time under 2 seconds on mid-range devices
- Zero security vulnerabilities in bridge implementations
- 100% API coverage in TypeScript definitions

## Sample Applications

### iOS Sample Features
- WKWebView with H5 bundle loading
- Native navigation integration
- Camera access with permission handling
- Local storage synchronization
- Push notification bridge
- Deep linking support

### Android Sample Features
- WebView with bundle loading
- Fragment-based integration
- Camera and gallery access
- SharedPreferences bridge
- Notification channel integration
- Intent handling for deep links

## Bridge API Examples

### Camera Plugin
```typescript
// H5 Side
const photo = await window.nativeBridge.camera.takePicture({
  quality: 0.8,
  maxWidth: 1200,
  source: 'camera'
});
```

### Storage Plugin
```typescript
// H5 Side
await window.nativeBridge.storage.set('user_preferences', {
  theme: 'dark',
  language: 'en'
});

const prefs = await window.nativeBridge.storage.get('user_preferences');
```

### Notification Plugin
```typescript
// H5 Side
await window.nativeBridge.notifications.show({
  title: 'Update Available',
  message: 'A new version is ready to install',
  actions: ['Update', 'Later']
});
```

## Future Enhancements

- Advanced plugin architecture with dynamic loading
- React Native bridge integration
- Flutter WebView integration examples
- Advanced debugging and profiling tools
- Automated testing frameworks for hybrid apps
- Performance monitoring integration

## Deployment Considerations

### iOS Considerations
- App Store review guidelines compliance
- iOS version compatibility matrix
- WKWebView security policies
- Bundle signing and verification

### Android Considerations
- Play Store policy compliance
- Android version compatibility
- WebView update handling
- APK size optimization with bundles

### Cross-Platform
- Consistent API surface across platforms
- Unified error handling and logging
- Shared bundle format validation
- Common security best practices